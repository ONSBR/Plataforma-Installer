FROM python:3.7-stretch

RUN apt-get -y update && apt-get -y upgrade && apt-get -y install git

RUN git clone -b fix_reprocess_celery https://github.com/onsplatform/platform_reprocess.git /var/worker/reprocess

WORKDIR /var/worker/reprocess

RUN pip install pipenv
RUN pipenv install --dev --system --deploy

CMD celery -A reprocess.discovery:app worker --loglevel=info